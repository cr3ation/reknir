<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Balansrapport - {{ company.name }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm 1.5cm 2cm 1.5cm;
            @top-right {
                content: "";
            }
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 7.5pt;
            line-height: 1.4;
            color: #222;
        }

        /* === HEADER === */
        .header-grid {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0;
        }

        .header-left {
            flex: 1;
        }

        .company-name {
            font-size: 9pt;
            font-weight: bold;
        }

        .company-org {
            font-size: 7.5pt;
            color: #444;
            margin-top: 1px;
        }

        .header-center {
            text-align: center;
            flex: 1;
        }

        .report-title {
            font-size: 13pt;
            font-weight: bold;
            color: #0066cc;
        }

        .header-right {
            flex: 1;
            font-size: 7.5pt;
            color: #444;
        }

        .header-right table {
            margin-left: auto;
        }

        .header-right td:first-child {
            padding-right: 12px;
        }

        .header-right td:last-child {
            text-align: right;
        }

        .page-current::after {
            content: counter(page);
        }

        .page-total::after {
            content: counter(pages);
        }

        .report-info {
            font-size: 7.5pt;
            color: #444;
            margin: 8px 0 14px 0;
            padding: 5px 0;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
        }

        /* === TABLE === */
        table.balance-table {
            width: 100%;
            border-collapse: collapse;
        }

        /* Column headers */
        table.balance-table th {
            text-align: right;
            font-size: 7.5pt;
            font-weight: bold;
            padding: 4px 0;
            color: #0066cc;
            border-bottom: 2px solid #0066cc;
        }

        table.balance-table th:first-child {
            text-align: left;
        }

        table.balance-table th.col-amount {
            width: 15%;
        }

        /* --- Level 1: Section headers (TILLGÅNGAR) --- */
        tr.section-header td {
            font-weight: bold;
            font-size: 8.5pt;
            padding: 12px 0 2px 0;
            border: none;
            color: #0066cc;
        }

        /* --- Level 2: Group headers (Anläggningstillgångar) --- */
        tr.group-header td {
            font-weight: bold;
            font-size: 7.5pt;
            padding: 5px 0 1px 16px;
            border: none;
        }

        /* --- Level 3: Subgroup headers (Materiella anläggningstillgångar) --- */
        tr.subgroup-header td {
            font-weight: bold;
            font-size: 7.5pt;
            padding: 4px 0 1px 32px;
            border: none;
        }

        /* --- Level 4: Account rows --- */
        tr.account-row td {
            padding: 1px 0;
            border: none;
            font-size: 7.5pt;
        }

        tr.account-row td:first-child {
            padding-left: 48px;
        }

        .account-number {
            font-family: 'Courier New', monospace;
            font-size: 7pt;
            color: #666;
            display: inline-block;
            width: 34px;
        }

        td.amount {
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 7.5pt;
            white-space: nowrap;
        }

        /* --- Subgroup sum (S:a Materiella...) — indented to account level --- */
        tr.subgroup-sum td {
            padding: 1px 0 4px 48px;
            border-top: 1px solid #999;
            font-size: 7.5pt;
        }

        tr.subgroup-sum td.amount {
            padding-left: 0;
        }

        /* --- Group sum (S:a Anläggningstillgångar) — indented to subgroup level --- */
        tr.group-sum td {
            padding: 2px 0 4px 32px;
            border-top: 1px solid #4a90c4;
            font-size: 7.5pt;
        }

        tr.group-sum td.amount {
            padding-left: 0;
        }

        /* --- Section sum (S:A TILLGÅNGAR) — indented to group level --- */
        tr.section-sum td {
            padding: 3px 0 3px 16px;
            border-top: 2px solid #0066cc;
            font-weight: bold;
            font-size: 7.5pt;
            color: #0066cc;
        }

        /* --- Årets resultat --- */
        tr.arets-resultat td {
            padding: 1px 0;
            font-size: 7.5pt;
            border: none;
        }

        tr.arets-resultat td:first-child {
            padding-left: 48px;
        }

        /* --- BERÄKNAT RESULTAT --- */
        tr.beraknat-resultat td {
            padding: 6px 0 3px 0;
            font-weight: bold;
            font-size: 8.5pt;
            border-top: 2px solid #0066cc;
            border-bottom: 2px solid #0066cc;
            color: #0066cc;
        }

        /* Spacer row */
        tr.spacer td {
            padding: 3px 0;
            border: none;
        }

        /* === FOOTER === */
        .footer {
            margin-top: 16px;
            padding-top: 6px;
            border-top: 1px solid #ddd;
            font-size: 6.5pt;
            color: #666;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header-grid">
        <div class="header-left">
            <div class="company-name">{{ company.name }}</div>
            <div class="company-org">{{ company.org_number }}</div>
        </div>
        <div class="header-center">
            <div class="report-title">Balansrapport</div>
        </div>
        <div class="header-right">
            <table>
                <tr><td>Sida:</td><td><span class="page-current"></span>(<span class="page-total"></span>)</td></tr>
                <tr><td>Utskrivet:</td><td>{{ generated_date }}</td></tr>
            </table>
        </div>
    </div>

    <div class="report-info">
        Räkenskapsår: {{ period_start }} – {{ period_end }}<br>
        Period: {{ period_start }} – {{ period_end }}
    </div>

    <!-- Balance table -->
    <table class="balance-table">
        <thead>
            <tr>
                <th></th>
                <th class="col-amount">Ing balans</th>
                <th class="col-amount">Period</th>
                <th class="col-amount">Utg balans</th>
            </tr>
        </thead>
        <tbody>
            <!-- ===== TILLGÅNGAR ===== -->
            <tr class="section-header">
                <td colspan="4">TILLGÅNGAR</td>
            </tr>

            {% for group in data.asset_groups %}
            <tr class="group-header">
                <td colspan="4">{{ group.title }}</td>
            </tr>

            {% for subgroup in group.subgroups %}
            {% if subgroup.title %}
            <tr class="subgroup-header">
                <td colspan="4">{{ subgroup.title }}</td>
            </tr>
            {% endif %}

            {% for account in subgroup.accounts %}
            <tr class="account-row">
                <td>
                    <span class="account-number">{{ account.account_number }}</span>
                    {{ account.name }}
                </td>
                <td class="amount">{{ account.ib|format_sek }}</td>
                <td class="amount">{{ account.period|format_sek }}</td>
                <td class="amount">{{ account.ub|format_sek }}</td>
            </tr>
            {% endfor %}

            {% if subgroup.title %}
            <tr class="subgroup-sum">
                <td>S:a {{ subgroup.title }}</td>
                <td class="amount">{{ subgroup.ib_total|format_sek }}</td>
                <td class="amount">{{ subgroup.period_total|format_sek }}</td>
                <td class="amount">{{ subgroup.ub_total|format_sek }}</td>
            </tr>
            {% endif %}
            {% endfor %}

            <tr class="spacer"><td colspan="4"></td></tr>
            <tr class="group-sum">
                <td>S:a {{ group.title }}</td>
                <td class="amount">{{ group.ib_total|format_sek }}</td>
                <td class="amount">{{ group.period_total|format_sek }}</td>
                <td class="amount">{{ group.ub_total|format_sek }}</td>
            </tr>
            <tr class="spacer"><td colspan="4"></td></tr>
            {% endfor %}

            <tr class="section-sum">
                <td>S:A TILLGÅNGAR</td>
                <td class="amount">{{ data.total_assets.ib|format_sek }}</td>
                <td class="amount">{{ data.total_assets.period|format_sek }}</td>
                <td class="amount">{{ data.total_assets.ub|format_sek }}</td>
            </tr>

            <!-- ===== EGET KAPITAL, AVSÄTTNINGAR OCH SKULDER ===== -->
            <tr class="spacer"><td colspan="4"></td></tr>
            <tr class="section-header">
                <td colspan="4">EGET KAPITAL, AVSÄTTNINGAR OCH SKULDER</td>
            </tr>

            {% for group in data.equity_liability_groups %}
            <tr class="group-header">
                <td colspan="4">{{ group.title }}</td>
            </tr>

            {% for subgroup in group.subgroups %}
            {% if subgroup.title %}
            <tr class="subgroup-header">
                <td colspan="4">{{ subgroup.title }}</td>
            </tr>
            {% endif %}

            {% for account in subgroup.accounts %}
            <tr class="account-row">
                <td>
                    <span class="account-number">{{ account.account_number }}</span>
                    {{ account.name }}
                </td>
                <td class="amount">{{ account.ib|format_sek }}</td>
                <td class="amount">{{ account.period|format_sek }}</td>
                <td class="amount">{{ account.ub|format_sek }}</td>
            </tr>
            {% endfor %}

            {% if subgroup.title %}
            <tr class="subgroup-sum">
                <td>S:a {{ subgroup.title }}</td>
                <td class="amount">{{ subgroup.ib_total|format_sek }}</td>
                <td class="amount">{{ subgroup.period_total|format_sek }}</td>
                <td class="amount">{{ subgroup.ub_total|format_sek }}</td>
            </tr>
            {% endif %}
            {% endfor %}

            <tr class="group-sum">
                <td>S:a {{ group.title }}</td>
                <td class="amount">{{ group.ib_total|format_sek }}</td>
                <td class="amount">{{ group.period_total|format_sek }}</td>
                <td class="amount">{{ group.ub_total|format_sek }}</td>
            </tr>
            <tr class="spacer"><td colspan="4"></td></tr>
            {% endfor %}

            <!-- Årets resultat (from P&L accounts) -->
            {% if data.arets_resultat.ib != 0 or data.arets_resultat.period != 0 %}
            <tr class="arets-resultat">
                <td>Beräknat resultat</td>
                <td class="amount">{{ data.arets_resultat.ib|format_sek }}</td>
                <td class="amount">{{ data.arets_resultat.period|format_sek }}</td>
                <td class="amount">{{ data.arets_resultat.ub|format_sek }}</td>
            </tr>
            <tr class="spacer"><td colspan="4"></td></tr>
            {% endif %}

            <tr class="section-sum">
                <td>S:A EGET KAPITAL, AVSÄTTNINGAR OCH SKULDER</td>
                <td class="amount">{{ data.total_equity_liabilities.ib|format_sek }}</td>
                <td class="amount">{{ data.total_equity_liabilities.period|format_sek }}</td>
                <td class="amount">{{ data.total_equity_liabilities.ub|format_sek }}</td>
            </tr>

            <!-- Beräknat resultat (should be 0) -->
            <tr class="spacer"><td colspan="4"></td></tr>
            <tr class="beraknat-resultat">
                <td>BERÄKNAT RESULTAT***</td>
                <td class="amount">{{ data.beraknat_resultat.ib|format_sek }}</td>
                <td class="amount">{{ data.beraknat_resultat.period|format_sek }}</td>
                <td class="amount">{{ data.beraknat_resultat.ub|format_sek }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Footer -->
    <div class="footer">
        {{ company.name }} | Org.nr: {{ company.org_number }}
        {% if company.is_vat_registered %} | Momsreg: {{ company.vat_number }}{% endif %}
    </div>
</body>
</html>
